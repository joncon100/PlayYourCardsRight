<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Card Pyramid + Retro Gameshow Background (Lift & Place)</title>

<style>
  :root{
    /* ==== CARD + GRID SIZING ==== */
    --cardW: 90px;
    --cardH: 126px;
    --gap: 14px;

    /* ==== TIMINGS ==== */
    --flipDur: 600ms;
    --moveDur: 650ms;
    --liftDur: 180ms;
    --liftPx: 18px;

    /* ==== BACKGROUND PANEL GRID ==== */
    --panelW: 260px;
    --panelH: 180px;
    --divider: 5px;

    --blueDark: #082a66;
    --blueMid:  #0b3a8a;
    --blueGlow: rgba(80, 190, 255, 0.42);

    --scanOpacity: 0.10;

    --sweepOpacity: 0.22;
    --sweepWidth: 260px;
    --sweepSpeed: 6.5s;

    --vignette: 0.55;
  }

  html, body{ height:100%; }

  body{
    margin:0;
    background:#021a3a;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }

  /* ======= RETRO GAME SHOW BACKGROUND ======= */
  .gameshow-bg{
    position:relative;
    padding:34px;
    border-radius: 10px;
    overflow:hidden;

    background:
      linear-gradient(180deg, var(--blueMid), var(--blueDark)),
      repeating-linear-gradient(
        to right,
        rgba(0,0,0,0.62) 0,
        rgba(0,0,0,0.62) var(--divider),
        transparent var(--divider),
        transparent var(--panelW)
      ),
      repeating-linear-gradient(
        to bottom,
        rgba(0,0,0,0.62) 0,
        rgba(0,0,0,0.62) var(--divider),
        transparent var(--divider),
        transparent var(--panelH)
      ),
      radial-gradient(ellipse at 25% 20%, rgba(120,210,255,0.18), transparent 55%),
      radial-gradient(ellipse at 75% 35%, rgba(120,210,255,0.12), transparent 60%),
      radial-gradient(ellipse at 55% 85%, rgba(120,210,255,0.10), transparent 60%);
    box-shadow:
      inset 0 0 0 3px rgba(0,0,0,0.95),
      inset 0 0 70px rgba(0,160,255,0.28),
      0 18px 50px rgba(0,0,0,0.40);
  }

  .gameshow-bg::before{
    content:"";
    position:absolute;
    inset:-2px;
    pointer-events:none;
    background:
      radial-gradient(ellipse at center,
        rgba(120,210,255,0.12),
        rgba(0,0,0,var(--vignette))
      ),
      repeating-linear-gradient(
        45deg,
        rgba(255,255,255,0.012) 0 2px,
        rgba(0,0,0,0.012) 2px 4px
      );
    mix-blend-mode: overlay;
  }

  .gameshow-bg::after{
    content:"";
    position:absolute;
    inset:0;
    pointer-events:none;
    background:
      repeating-linear-gradient(
        to bottom,
        rgba(0,0,0,var(--scanOpacity)) 0px,
        rgba(0,0,0,var(--scanOpacity)) 1px,
        rgba(255,255,255,0.02) 2px,
        rgba(255,255,255,0.00) 4px
      );
    opacity:0.9;
  }

  .sweep{
    position:absolute;
    top:-30%;
    left:-40%;
    width: var(--sweepWidth);
    height: 160%;
    pointer-events:none;
    background: linear-gradient(
      90deg,
      rgba(255,255,255,0.00),
      rgba(255,255,255,var(--sweepOpacity)),
      rgba(255,255,255,0.00)
    );
    transform: rotate(18deg);
    filter: blur(1px);
    animation: sweep var(--sweepSpeed) ease-in-out infinite;
    mix-blend-mode: screen;
  }

  @keyframes sweep{
    0%   { transform: translateX(-40%) rotate(18deg); opacity: 0; }
    12%  { opacity: 1; }
    40%  { opacity: 1; }
    55%  { opacity: 0; }
    100% { transform: translateX(230%) rotate(18deg); opacity: 0; }
  }

  /* ======= CARD TABLE LAYOUT (fixed slots) ======= */
  #table{
    position:relative;
    z-index:2;
    display:flex;
    flex-direction:column;
    gap:18px;
    user-select:none;
  }

  .row{
    display:flex;
    gap:var(--gap);
    justify-content:flex-start;
  }

  .slot{
    width:var(--cardW);
    height:var(--cardH);
    position:relative;
  }

  /* ======= CARD 3D FLIP ======= */
  .scene{
    width:100%;
    height:100%;
    perspective:900px;
    filter: drop-shadow(0 10px 22px rgba(0,0,0,0.35));
    position:relative;
    z-index:0;
    will-change: transform;
  }

  .scene.moving{
    z-index:999;
    filter: drop-shadow(0 18px 34px rgba(0,0,0,0.55));
  }

  .card{
    width:100%;
    height:100%;
    position:relative;
    transform-style:preserve-3d;
    transform: rotateX(0deg); /* face-down default */
    transition: transform var(--flipDur) ease-in-out;
    will-change: transform;
  }

  .face{
    position:absolute;
    inset:0;
    backface-visibility:hidden;
    -webkit-backface-visibility:hidden;
    overflow:hidden;
  }

  .face img{
    width:100%;
    height:100%;
    object-fit:contain;
    display:block;
  }

  /* z-separation prevents face bleed through on some GPUs */
  .back  { transform: rotateX(0deg)   translateZ(0.6px); }
  .front { transform: rotateX(180deg) translateZ(0.6px); }

  .card.is-flipped{ transform: rotateX(180deg); }

  @media (prefers-reduced-motion: reduce){
    .card{ transition:none; }
    .sweep{ animation:none; }
  }
</style>
</head>

<body>
  <div class="gameshow-bg">
    <div class="sweep"></div>

    <div id="table">
      <!-- Row 3: [b] [8] [ ] [ ] -->
      <div class="row" id="row3">
        <div class="slot" id="slot-b"></div>

        <div class="slot" id="slot-8">
          <div class="scene" id="s8">
            <div class="card" id="c8">
              <div class="face back"><img src="cardback3.png" alt="Back"></div>
              <div class="face front"><img src="jack_of_diamonds2.png" alt="8 face"></div>
            </div>
          </div>
        </div>

        <div class="slot"></div>
        <div class="slot"></div>
      </div>

      <!-- Row 2: [a] [5] [6] [7] -->
      <div class="row" id="row2">
        <div class="slot" id="slot-a"></div>

        <div class="slot" id="slot-5">
          <div class="scene" id="s5">
            <div class="card" id="c5">
              <div class="face back"><img src="cardback3.png" alt="Back"></div>
              <div class="face front"><img src="jack_of_diamonds2.png" alt="5 face"></div>
            </div>
          </div>
        </div>

        <div class="slot" id="slot-6">
          <div class="scene" id="s6">
            <div class="card" id="c6">
              <div class="face back"><img src="cardback3.png" alt="Back"></div>
              <div class="face front"><img src="jack_of_diamonds2.png" alt="6 face"></div>
            </div>
          </div>
        </div>

        <div class="slot" id="slot-7">
          <div class="scene" id="s7">
            <div class="card" id="c7">
              <div class="face back"><img src="cardback3.png" alt="Back"></div>
              <div class="face front"><img src="jack_of_diamonds2.png" alt="7 face"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Row 1: [1] [2] [3] [4] -->
      <div class="row" id="row1">
        <div class="slot" id="slot-1">
          <div class="scene" id="s1">
            <div class="card is-flipped" id="c1">
              <div class="face back"><img src="cardback3.png" alt="Back"></div>
              <div class="face front"><img src="jack_of_diamonds2.png" alt="1 face"></div>
            </div>
          </div>
        </div>

        <div class="slot" id="slot-2">
          <div class="scene" id="s2">
            <div class="card" id="c2">
              <div class="face back"><img src="cardback3.png" alt="Back"></div>
              <div class="face front"><img src="jack_of_diamonds2.png" alt="2 face"></div>
            </div>
          </div>
        </div>

        <div class="slot" id="slot-3">
          <div class="scene" id="s3">
            <div class="card" id="c3">
              <div class="face back"><img src="cardback3.png" alt="Back"></div>
              <div class="face front"><img src="jack_of_diamonds2.png" alt="3 face"></div>
            </div>
          </div>
        </div>

        <div class="slot" id="slot-4">
          <div class="scene" id="s4">
            <div class="card" id="c4">
              <div class="face back"><img src="cardback3.png" alt="Back"></div>
              <div class="face front"><img src="jack_of_diamonds2.png" alt="4 face"></div>
            </div>
          </div>
        </div>
      </div>
    </div><!-- /#table -->
  </div><!-- /.gameshow-bg -->

<script>
  const wait = (ms) => new Promise(r => setTimeout(r, ms));

  // Keep these aligned with CSS vars if you edit timings
  const flipDur = 600;
  const moveDur = 650;
  const liftDur = 180;
  const liftPx  = 18;

  function resetAllCards(){
    // Force everything face-down first, then set c1 face-up.
    document.querySelectorAll(".card").forEach(c => c.classList.remove("is-flipped"));
    document.getElementById("c1").classList.add("is-flipped");
  }

  function flip(cardId){
    document.getElementById(cardId).classList.add("is-flipped");
  }

  async function moveSceneToSlotLift(sceneId, slotId){
    const scene = document.getElementById(sceneId);
    const allScenes = Array.from(document.querySelectorAll(".scene"));

    // LIFT
    scene.classList.add("moving");
    scene.style.transition = `transform ${liftDur}ms ease-out`;
    scene.style.transform  = `translateY(-${liftPx}px) scale(1.04)`;
    await wait(liftDur);

    // FIRST (while lifted)
    const first = new Map();
    allScenes.forEach(s => first.set(s.id, s.getBoundingClientRect()));

    // DOM CHANGE (move to fixed slot => rows never shift)
    document.getElementById(slotId).appendChild(scene);

    // LAST
    const last = new Map();
    allScenes.forEach(s => last.set(s.id, s.getBoundingClientRect()));

    // INVERT
    allScenes.forEach(s => {
      const f = first.get(s.id), l = last.get(s.id);
      if(!f || !l) return;

      const dx = f.left - l.left;
      const dy = f.top  - l.top;

      if(dx || dy){
        s.style.transition = "transform 0s";
        if(s.id === sceneId){
          s.style.transform = `translate(${dx}px, ${dy - liftPx}px) scale(1.04)`;
        } else {
          s.style.transform = `translate(${dx}px, ${dy}px)`;
        }
      }
    });

    // PLAY (slide)
    void document.body.offsetHeight;

    allScenes.forEach(s => {
      if(s.style.transform){
        s.style.transition = `transform ${moveDur}ms ease-in-out`;
        if(s.id === sceneId){
          s.style.transform = `translateY(-${liftPx}px) scale(1.04)`;
        } else {
          s.style.transform = "";
        }
      }
    });

    await wait(moveDur);

    // DROP
    scene.style.transition = `transform ${liftDur}ms ease-in`;
    scene.style.transform  = "";
    await wait(liftDur);

    // CLEANUP
    allScenes.forEach(s => { s.style.transition=""; s.style.transform=""; });
    scene.classList.remove("moving");
  }

  async function runSequence(){
    resetAllCards();
    await wait(60);

    // Your sequence
    flip("c2"); await wait(flipDur + 300);
    flip("c3"); await wait(flipDur + 300);
    flip("c4"); await wait(flipDur + 300);

    await moveSceneToSlotLift("s4", "slot-a");

    flip("c5"); await wait(flipDur + 300);
    flip("c6"); await wait(flipDur + 300);
    flip("c7"); await wait(flipDur + 300);

    await moveSceneToSlotLift("s7", "slot-b");

    flip("c8");
  }

  // Autostart (for your hosted page). If you want click-to-start in AhaSlides, swap this:
  // document.addEventListener("click", () => runSequence(), { once: true });
  runSequence();
</script>

</body>
</html>
