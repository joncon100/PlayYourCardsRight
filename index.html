<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Card Pyramid Sequence (Lift & Place)</title>

<style>
  body{
    margin:0;
    background:#0b3d2e;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }

  :root{
    --cardW: 90px;
    --cardH: 126px;
    --gap: 14px;
    --flipDur: 600ms;
    --moveDur: 650ms;
    --liftDur: 180ms;
    --liftPx: 18px;
  }

  #table{
    display:flex;
    flex-direction:column;
    gap:18px;
    user-select:none;
  }

  .row{
    display:flex;
    gap:var(--gap);
    justify-content:flex-start;
  }

  .slot{
    width:var(--cardW);
    height:var(--cardH);
    position:relative;
  }

  .scene{
    width:100%;
    height:100%;
    perspective:900px;
    filter: drop-shadow(0 10px 22px rgba(0,0,0,0.35));
    position:relative;
    z-index:0;
    will-change: transform;
  }

  .scene.moving{
    z-index:999;
    filter: drop-shadow(0 18px 34px rgba(0,0,0,0.55));
  }

  .card{
    width:100%;
    height:100%;
    position:relative;
    transform-style:preserve-3d;
    transform: rotateX(0deg);
    transition: transform var(--flipDur) ease-in-out;
    will-change: transform;
  }

  .face{
    position:absolute;
    inset:0;
    backface-visibility:hidden;
    -webkit-backface-visibility:hidden;
    overflow:hidden;
  }

  .face img{
    width:100%;
    height:100%;
    object-fit:contain;
    display:block;
  }

  .back  { transform: rotateX(0deg) translateZ(0.6px); }
  .front { transform: rotateX(180deg) translateZ(0.6px); }

  .card.is-flipped{
    transform: rotateX(180deg);
  }

  @media (prefers-reduced-motion: reduce){
    .card{ transition:none; }
  }
</style>
</head>

<body>

<div id="table">

  <!-- Row 3: [b] [8] [ ] [ ] -->
  <div class="row" id="row3">
    <div class="slot" id="slot-b"></div>

    <div class="slot" id="slot-8">
      <div class="scene" id="s8">
        <div class="card" id="c8">
          <div class="face back"><img src="cardback3.png" alt="Back"></div>
          <div class="face front"><img src="jack_of_diamonds2.png" alt="8 face"></div>
        </div>
      </div>
    </div>

    <div class="slot"></div>
    <div class="slot"></div>
  </div>

  <!-- Row 2: [a] [5] [6] [7] -->
  <div class="row" id="row2">
    <div class="slot" id="slot-a"></div>

    <div class="slot" id="slot-5">
      <div class="scene" id="s5">
        <div class="card" id="c5">
          <div class="face back"><img src="cardback3.png" alt="Back"></div>
          <div class="face front"><img src="jack_of_diamonds2.png" alt="5 face"></div>
        </div>
      </div>
    </div>

    <div class="slot" id="slot-6">
      <div class="scene" id="s6">
        <div class="card" id="c6">
          <div class="face back"><img src="cardback3.png" alt="Back"></div>
          <div class="face front"><img src="jack_of_diamonds2.png" alt="6 face"></div>
        </div>
      </div>
    </div>

    <div class="slot" id="slot-7">
      <div class="scene" id="s7">
        <div class="card" id="c7">
          <div class="face back"><img src="cardback3.png" alt="Back"></div>
          <div class="face front"><img src="jack_of_diamonds2.png" alt="7 face"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Row 1: [1] [2] [3] [4] -->
  <div class="row" id="row1">
    <div class="slot" id="slot-1">
      <div class="scene" id="s1">
        <div class="card is-flipped" id="c1">
          <div class="face back"><img src="cardback3.png" alt="Back"></div>
          <div class="face front"><img src="jack_of_diamonds2.png" alt="1 face"></div>
        </div>
      </div>
    </div>

    <div class="slot" id="slot-2">
      <div class="scene" id="s2">
        <div class="card" id="c2">
          <div class="face back"><img src="cardback3.png" alt="Back"></div>
          <div class="face front"><img src="jack_of_diamonds2.png" alt="2 face"></div>
        </div>
      </div>
    </div>

    <div class="slot" id="slot-3">
      <div class="scene" id="s3">
        <div class="card" id="c3">
          <div class="face back"><img src="cardback3.png" alt="Back"></div>
          <div class="face front"><img src="jack_of_diamonds2.png" alt="3 face"></div>
        </div>
      </div>
    </div>

    <div class="slot" id="slot-4">
      <div class="scene" id="s4">
        <div class="card" id="c4">
          <div class="face back"><img src="cardback3.png" alt="Back"></div>
          <div class="face front"><img src="jack_of_diamonds2.png" alt="4 face"></div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
  const wait = (ms) => new Promise(r => setTimeout(r, ms));

  const flipDur = 600;
  const moveDur = 650;
  const liftDur = 180;
  const liftPx  = 18;

  function resetAllCards(){
    // Force everything face-down first, then set c1 face-up.
    document.querySelectorAll(".card").forEach(c => c.classList.remove("is-flipped"));
    document.getElementById("c1").classList.add("is-flipped");
  }

  function flip(cardId){
    document.getElementById(cardId).classList.add("is-flipped");
  }

  async function moveSceneToSlotLift(sceneId, slotId){
    const scene = document.getElementById(sceneId);
    const allScenes = Array.from(document.querySelectorAll(".scene"));

    // Lift
    scene.classList.add("moving");
    scene.style.transition = `transform ${liftDur}ms ease-out`;
    scene.style.transform  = `translateY(-${liftPx}px) scale(1.04)`;
    await wait(liftDur);

    // First
    const first = new Map();
    allScenes.forEach(s => first.set(s.id, s.getBoundingClientRect()));

    // DOM change
    document.getElementById(slotId).appendChild(scene);

    // Last
    const last = new Map();
    allScenes.forEach(s => last.set(s.id, s.getBoundingClientRect()));

    // Invert
    allScenes.forEach(s => {
      const f = first.get(s.id), l = last.get(s.id);
      if(!f || !l) return;

      const dx = f.left - l.left;
      const dy = f.top  - l.top;

      if(dx || dy){
        s.style.transition = "transform 0s";
        if(s.id === sceneId){
          s.style.transform = `translate(${dx}px, ${dy - liftPx}px) scale(1.04)`;
        } else {
          s.style.transform = `translate(${dx}px, ${dy}px)`;
        }
      }
    });

    void document.body.offsetHeight;

    // Play slide
    allScenes.forEach(s => {
      if(s.style.transform){
        s.style.transition = `transform ${moveDur}ms ease-in-out`;
        if(s.id === sceneId){
          s.style.transform = `translateY(-${liftPx}px) scale(1.04)`;
        } else {
          s.style.transform = "";
        }
      }
    });

    await wait(moveDur);

    // Drop
    scene.style.transition = `transform ${liftDur}ms ease-in`;
    scene.style.transform  = "";
    await wait(liftDur);

    // Cleanup
    allScenes.forEach(s => { s.style.transition=""; s.style.transform=""; });
    scene.classList.remove("moving");
  }

  async function runSequence(){
    resetAllCards();               // <-- makes c2 behave same as c3/c4 at start
    await wait(50);                // allow layout settle

    flip("c2"); await wait(flipDur + 300);
    flip("c3"); await wait(flipDur + 300);
    flip("c4"); await wait(flipDur + 300);

    await moveSceneToSlotLift("s4", "slot-a");

    flip("c5"); await wait(flipDur + 300);
    flip("c6"); await wait(flipDur + 300);
    flip("c7"); await wait(flipDur + 300);

    await moveSceneToSlotLift("s7", "slot-b");

    flip("c8");
  }

  runSequence();
</script>

</body>
</html>
