<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Card Sequence â€“ Per-Position Discards</title>

<style>
  :root{
    --cardW: 90px;
    --cardH: 126px;
    --gap: 14px;

    --flipDur: 600ms;
    --moveDur: 650ms;
    --liftDur: 180ms;
    --liftPx: 18px;
  }

  html, body { height:100%; }

  body{
    margin:0;
    background: transparent;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }

  .wrap{ padding:12px; }

  #table{
    display:flex;
    flex-direction:column;
    gap:18px;
    user-select:none;
  }

  .row{ display:flex; gap:var(--gap); }

  .slot{
    width:var(--cardW);
    height:var(--cardH);
    position:relative;
  }

  .scene{
    width:100%;
    height:100%;
    perspective:900px;
    filter: drop-shadow(0 10px 22px rgba(0,0,0,0.35));
    cursor:pointer;
  }

  .scene.moving{
    z-index:999;
    filter: drop-shadow(0 18px 34px rgba(0,0,0,0.55));
  }

  .card{
    width:100%;
    height:100%;
    position:relative;
    transform-style:preserve-3d;
    transform: rotateX(0deg);
    transition: transform var(--flipDur) ease-in-out;
  }

  .face{
    position:absolute;
    inset:0;
    backface-visibility:hidden;
  }

  .face img{
    width:100%;
    height:100%;
    object-fit:contain;
  }

  .back  { transform: rotateX(0deg)   translateZ(0.6px); }
  .front { transform: rotateX(180deg) translateZ(0.6px); }

  .card.is-flipped{ transform: rotateX(180deg); }

  .hint{
    position:fixed;
    left:12px;
    bottom:12px;
    background:rgba(0,0,0,0.45);
    color:#fff;
    padding:8px 10px;
    border-radius:10px;
    font-size:13px;
    max-width:46ch;
  }
</style>
</head>

<body>
<div class="wrap">

<div id="table">

  <!-- Row 3 -->
  <div class="row">
    <div class="slot" id="slot-b"></div>

    <div class="slot" id="slot-8">
      <div class="scene" id="s8">
        <div class="card" id="c8">
          <div class="face back"><img src="cardback3.png"></div>
          <div class="face front"><img id="face8"></div>
        </div>
      </div>
    </div>

    <div class="slot"></div>
    <div class="slot"></div>
  </div>

  <!-- Row 2 -->
  <div class="row">
    <div class="slot" id="slot-a"></div>

    <div class="slot"><div class="scene" id="s5"><div class="card" id="c5">
      <div class="face back"><img src="cardback3.png"></div>
      <div class="face front"><img id="face5"></div>
    </div></div></div>

    <div class="slot"><div class="scene" id="s6"><div class="card" id="c6">
      <div class="face back"><img src="cardback3.png"></div>
      <div class="face front"><img id="face6"></div>
    </div></div></div>

    <div class="slot"><div class="scene" id="s7"><div class="card" id="c7">
      <div class="face back"><img src="cardback3.png"></div>
      <div class="face front"><img id="face7"></div>
    </div></div></div>
  </div>

  <!-- Row 1 -->
  <div class="row">
    <div class="slot" id="slot-1">
      <div class="scene" id="s1">
        <div class="card is-flipped" id="c1">
          <div class="face back"><img src="cardback3.png"></div>
          <div class="face front"><img id="face1"></div>
        </div>
      </div>
    </div>

    <div class="slot"><div class="scene" id="s2"><div class="card" id="c2">
      <div class="face back"><img src="cardback3.png"></div>
      <div class="face front"><img id="face2"></div>
    </div></div></div>

    <div class="slot"><div class="scene" id="s3"><div class="card" id="c3">
      <div class="face back"><img src="cardback3.png"></div>
      <div class="face front"><img id="face3"></div>
    </div></div></div>

    <div class="slot"><div class="scene" id="s4"><div class="card" id="c4">
      <div class="face back"><img src="cardback3.png"></div>
      <div class="face front"><img id="face4"></div>
    </div></div></div>
  </div>

</div>
</div>

<div class="hint" id="hint">
Click anywhere to advance. Click cards in positions 1 / left of 5 / left of 8 to discard (once each).
</div>

<script>
/* ====== DECK ====== */
const FACE_IMAGES = [
  "faces/10_of_clubs.png","faces/10_of_diamonds.png","faces/10_of_hearts.png","faces/10_of_spades.png",
  "faces/2_of_clubs.png","faces/2_of_diamonds.png","faces/2_of_hearts.png","faces/2_of_spades.png",
  "faces/3_of_clubs.png","faces/3_of_diamonds.png","faces/3_of_hearts.png","faces/3_of_spades.png",
  "faces/4_of_clubs.png","faces/4_of_diamonds.png","faces/4_of_hearts.png","faces/4_of_spades.png",
  "faces/5_of_clubs.png","faces/5_of_diamonds.png","faces/5_of_hearts.png","faces/5_of_spades.png",
  "faces/6_of_clubs.png","faces/6_of_diamonds.png","faces/6_of_hearts.png","faces/6_of_spades.png",
  "faces/7_of_clubs.png","faces/7_of_diamonds.png","faces/7_of_hearts.png","faces/7_of_spades.png",
  "faces/8_of_clubs.png","faces/8_of_diamonds.png","faces/8_of_hearts.png","faces/8_of_spades.png",
  "faces/9_of_clubs.png","faces/9_of_diamonds.png","faces/9_of_hearts.png","faces/9_of_spades.png",
  "faces/ace_of_clubs.png","faces/ace_of_diamonds.png","faces/ace_of_hearts.png","faces/ace_of_spades2.png",
  "faces/jack_of_clubs2.png","faces/jack_of_diamonds2.png","faces/jack_of_hearts2.png","faces/jack_of_spades2.png",
  "faces/queen_of_clubs2.png","faces/queen_of_diamonds2.png","faces/queen_of_hearts2.png","faces/queen_of_spades2.png",
  "faces/king_of_clubs2.png","faces/king_of_diamonds2.png","faces/king_of_hearts2.png","faces/king_of_spades2.png"
];

let deck = [];
const usedDiscardSlots = new Set();

const wait = ms => new Promise(r=>setTimeout(r,ms));

function shuffle(a){
  a=[...a];
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function deal(){
  deck = shuffle(FACE_IMAGES);
  const faces = deck.splice(0,8);
  for(let i=1;i<=8;i++){
    document.getElementById("face"+i).src = faces[i-1];
  }
}

function reset(){
  document.querySelectorAll(".card").forEach(c=>c.classList.remove("is-flipped"));
  document.getElementById("c1").classList.add("is-flipped");
}

function discardSlot(scene){
  return scene.parentElement.id;
}

function canDiscard(scene){
  const slot = discardSlot(scene);
  return ["slot-1","slot-a","slot-b"].includes(slot)
    && !usedDiscardSlots.has(slot)
    && deck.length>0;
}

async function discard(scene){
  if(!canDiscard(scene)) return;

  usedDiscardSlots.add(discardSlot(scene));

  const card = scene.querySelector(".card");
  const img  = scene.querySelector(".front img");

  scene.classList.add("moving");
  scene.style.transition="transform 200ms,opacity 200ms";
  scene.style.transform="scale(0.6)";
  scene.style.opacity="0";
  await wait(200);

  img.src = deck.shift();
  card.classList.add("is-flipped");

  scene.style.transform="";
  scene.style.opacity="1";
  await wait(200);

  scene.classList.remove("moving");
}

async function move(sceneId, slotId){
  const s=document.getElementById(sceneId);
  s.classList.add("moving");
  s.style.transform=`translateY(-18px) scale(1.04)`;
  await wait(180);
  document.getElementById(slotId).appendChild(s);
  s.style.transform="";
  await wait(650);
  s.classList.remove("moving");
}

/* ====== SEQUENCE ====== */
const steps=[
  ()=>c2.classList.add("is-flipped"),
  ()=>c3.classList.add("is-flipped"),
  ()=>c4.classList.add("is-flipped"),
  ()=>move("s4","slot-a"),
  ()=>c5.classList.add("is-flipped"),
  ()=>c6.classList.add("is-flipped"),
  ()=>c7.classList.add("is-flipped"),
  ()=>move("s7","slot-b"),
  ()=>c8.classList.add("is-flipped")
];

let step=0,busy=false;

async function advance(){
  if(busy||step>=steps.length) return;
  busy=true;
  await steps[step++]();
  busy=false;
}

/* ====== INIT ====== */
deal();
reset();

document.addEventListener("click", advance);

document.querySelectorAll(".scene").forEach(s=>{
  s.addEventListener("click", e=>{
    e.stopPropagation();
    discard(s);
  });
});
</script>

</body>
</html>
