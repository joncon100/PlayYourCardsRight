<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Click-to-Step Card Grid (Transparent + Random Faces)</title>

<style>
  :root{
    --cardW: 90px;
    --cardH: 126px;
    --gap: 14px;

    --flipDur: 600ms;
    --moveDur: 650ms;
    --liftDur: 180ms;
    --liftPx: 18px;
  }

  html, body{ height:100%; }

  /* Transparent page background */
  body{
    margin:0;
    background: transparent;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }

  /* Optional: if you want a little spacing when embedded */
  .wrap{
    padding: 12px;
  }

  /* Fixed 4-slot rows so nothing shifts when cards move into empty slots */
  #table{
    display:flex;
    flex-direction:column;
    gap:18px;
    user-select:none;
  }

  .row{
    display:flex;
    gap:var(--gap);
    justify-content:flex-start;
  }

  .slot{
    width:var(--cardW);
    height:var(--cardH);
    position:relative;
  }

  .scene{
    width:100%;
    height:100%;
    perspective:900px;
    filter: drop-shadow(0 10px 22px rgba(0,0,0,0.35));
    position:relative;
    z-index:0;
    will-change: transform;
  }

  .scene.moving{
    z-index:999;
    filter: drop-shadow(0 18px 34px rgba(0,0,0,0.55));
  }

  .card{
    width:100%;
    height:100%;
    position:relative;
    transform-style:preserve-3d;
    transform: rotateX(0deg); /* face-down default */
    transition: transform var(--flipDur) ease-in-out;
    will-change: transform;
  }

  .face{
    position:absolute;
    inset:0;
    backface-visibility:hidden;
    -webkit-backface-visibility:hidden;
    overflow:hidden;
  }

  .face img{
    width:100%;
    height:100%;
    object-fit:contain;
    display:block;
  }

  /* z-separation prevents face bleed-through on some GPUs */
  .back  { transform: rotateX(0deg)   translateZ(0.6px); }
  .front { transform: rotateX(180deg) translateZ(0.6px); }

  .card.is-flipped{ transform: rotateX(180deg); }

  /* Small hint overlay (optional) */
  .hint{
    position:fixed;
    left:12px;
    bottom:12px;
    color:rgba(255,255,255,0.85);
    background:rgba(0,0,0,0.35);
    padding:8px 10px;
    border-radius:10px;
    font-size:13px;
    backdrop-filter: blur(4px);
  }
</style>
</head>

<body>
<div class="wrap">

  <div id="table">
    <!-- Row 3: [b] [8] [ ] [ ] -->
    <div class="row" id="row3">
      <div class="slot" id="slot-b"></div>

      <div class="slot" id="slot-8">
        <div class="scene" id="s8">
          <div class="card" id="c8">
            <div class="face back"><img id="back8" src="cardback3.png" alt="Back"></div>
            <div class="face front"><img id="face8" src="" alt="Face 8"></div>
          </div>
        </div>
      </div>

      <div class="slot"></div>
      <div class="slot"></div>
    </div>

    <!-- Row 2: [a] [5] [6] [7] -->
    <div class="row" id="row2">
      <div class="slot" id="slot-a"></div>

      <div class="slot" id="slot-5">
        <div class="scene" id="s5">
          <div class="card" id="c5">
            <div class="face back"><img id="back5" src="cardback3.png" alt="Back"></div>
            <div class="face front"><img id="face5" src="" alt="Face 5"></div>
          </div>
        </div>
      </div>

      <div class="slot" id="slot-6">
        <div class="scene" id="s6">
          <div class="card" id="c6">
            <div class="face back"><img id="back6" src="cardback3.png" alt="Back"></div>
            <div class="face front"><img id="face6" src="" alt="Face 6"></div>
          </div>
        </div>
      </div>

      <div class="slot" id="slot-7">
        <div class="scene" id="s7">
          <div class="card" id="c7">
            <div class="face back"><img id="back7" src="cardback3.png" alt="Back"></div>
            <div class="face front"><img id="face7" src="" alt="Face 7"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Row 1: [1] [2] [3] [4] -->
    <div class="row" id="row1">
      <div class="slot" id="slot-1">
        <div class="scene" id="s1">
          <div class="card is-flipped" id="c1">
            <div class="face back"><img id="back1" src="cardback3.png" alt="Back"></div>
            <div class="face front"><img id="face1" src="" alt="Face 1"></div>
          </div>
        </div>
      </div>

      <div class="slot" id="slot-2">
        <div class="scene" id="s2">
          <div class="card" id="c2">
            <div class="face back"><img id="back2" src="cardback3.png" alt="Back"></div>
            <div class="face front"><img id="face2" src="" alt="Face 2"></div>
          </div>
        </div>
      </div>

      <div class="slot" id="slot-3">
        <div class="scene" id="s3">
          <div class="card" id="c3">
            <div class="face back"><img id="back3" src="cardback3.png" alt="Back"></div>
            <div class="face front"><img id="face3" src="" alt="Face 3"></div>
          </div>
        </div>
      </div>

      <div class="slot" id="slot-4">
        <div class="scene" id="s4">
          <div class="card" id="c4">
            <div class="face back"><img id="back4" src="cardback3.png" alt="Back"></div>
            <div class="face front"><img id="face4" src="" alt="Face 4"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<div class="hint" id="hint">Click to step (flip/move). First click flips 2.</div>

<script>
  // ====== 1) Provide a pool of face images (NO duplicates will be chosen) ======
  // Put these files in your GitHub Pages repo and reference them here.
  // Example: if you store them in /faces/, use "faces/AS.png", etc.
const FACE_IMAGES = [
  "faces/ace_of_clubs.png",
  "faces/ace_of_diamonds.png",
  "faces/ace_of_hearts.png",
  "faces/ace_of_spades2.png",

  "faces/2_of_clubs.png",
  "faces/2_of_diamonds.png",
  "faces/2_of_hearts.png",
  "faces/2_of_spades.png",

  "faces/3_of_clubs.png",
  "faces/3_of_diamonds.png",
  "faces/3_of_hearts.png",
  "faces/3_of_spades.png",

  "faces/4_of_clubs.png",
  "faces/4_of_diamonds.png",
  "faces/4_of_hearts.png",
  "faces/4_of_spades.png",

  "faces/5_of_clubs.png",
  "faces/5_of_diamonds.png",
  "faces/5_of_hearts.png",
  "faces/5_of_spades.png",

  "faces/6_of_clubs.png",
  "faces/6_of_diamonds.png",
  "faces/6_of_hearts.png",
  "faces/6_of_spades.png",

  "faces/7_of_clubs.png",
  "faces/7_of_diamonds.png",
  "faces/7_of_hearts.png",
  "faces/7_of_spades.png",

  "faces/8_of_clubs.png",
  "faces/8_of_diamonds.png",
  "faces/8_of_hearts.png",
  "faces/8_of_spades.png",

  "faces/9_of_clubs.png",
  "faces/9_of_diamonds.png",
  "faces/9_of_hearts.png",
  "faces/9_of_spades.png",

  "faces/10_of_clubs.png",
  "faces/10_of_diamonds.png",
  "faces/10_of_hearts.png",
  "faces/10_of_spades.png",

  "faces/jack_of_clubs2.png",
  "faces/jack_of_diamonds2.png",
  "faces/jack_of_hearts2.png",
  "faces/jack_of_spades2.png",

  "faces/queen_of_clubs2.png",
  "faces/queen_of_diamonds2.png",
  "faces/queen_of_hearts2.png",
  "faces/queen_of_spades2.png",

  "faces/king_of_clubs2.png",
  "faces/king_of_diamonds2.png",
  "faces/king_of_hearts2.png",
  "faces/king_of_spades2.png"
];
  // ====== 2) Helpers ======
  const wait = (ms) => new Promise(r => setTimeout(r, ms));
  const flipDur = 600;
  const moveDur = 650;
  const liftDur = 180;
  const liftPx  = 18;

  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1; i>0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function setFacesRandomUnique(){
    if(FACE_IMAGES.length < 8){
      throw new Error("FACE_IMAGES needs at least 8 images.");
    }
    const pick = shuffle(FACE_IMAGES).slice(0, 8); // unique by construction

    // Map chosen faces to cards 1..8
    const ids = ["face1","face2","face3","face4","face5","face6","face7","face8"];
    ids.forEach((imgId, idx) => {
      const el = document.getElementById(imgId);
      el.src = pick[idx];
    });
  }

  function resetAllCards(){
    document.querySelectorAll(".card").forEach(c => c.classList.remove("is-flipped"));
    document.getElementById("c1").classList.add("is-flipped"); // 1 starts face up
  }

  function flip(cardId){
    document.getElementById(cardId).classList.add("is-flipped");
  }

  async function moveSceneToSlotLift(sceneId, slotId){
    const scene = document.getElementById(sceneId);
    const allScenes = Array.from(document.querySelectorAll(".scene"));

    // LIFT
    scene.classList.add("moving");
    scene.style.transition = `transform ${liftDur}ms ease-out`;
    scene.style.transform  = `translateY(-${liftPx}px) scale(1.04)`;
    await wait(liftDur);

    // FIRST (while lifted)
    const first = new Map();
    allScenes.forEach(s => first.set(s.id, s.getBoundingClientRect()));

    // DOM CHANGE
    document.getElementById(slotId).appendChild(scene);

    // LAST
    const last = new Map();
    allScenes.forEach(s => last.set(s.id, s.getBoundingClientRect()));

    // INVERT
    allScenes.forEach(s => {
      const f = first.get(s.id), l = last.get(s.id);
      if(!f || !l) return;

      const dx = f.left - l.left;
      const dy = f.top  - l.top;

      if(dx || dy){
        s.style.transition = "transform 0s";
        if(s.id === sceneId){
          s.style.transform = `translate(${dx}px, ${dy - liftPx}px) scale(1.04)`;
        } else {
          s.style.transform = `translate(${dx}px, ${dy}px)`;
        }
      }
    });

    void document.body.offsetHeight;

    // PLAY (slide)
    allScenes.forEach(s => {
      if(s.style.transform){
        s.style.transition = `transform ${moveDur}ms ease-in-out`;
        if(s.id === sceneId){
          s.style.transform = `translateY(-${liftPx}px) scale(1.04)`;
        } else {
          s.style.transform = "";
        }
      }
    });

    await wait(moveDur);

    // DROP
    scene.style.transition = `transform ${liftDur}ms ease-in`;
    scene.style.transform  = "";
    await wait(liftDur);

    // CLEANUP
    allScenes.forEach(s => { s.style.transition=""; s.style.transform=""; });
    scene.classList.remove("moving");
  }

  // ====== 3) Click-to-step state machine ======
  // Sequence you wanted:
  // flip 2, flip 3, flip 4, move 4 -> a, flip 5, flip 6, flip 7, move 7 -> b, flip 8
  const steps = [
    async () => { flip("c2"); await wait(flipDur); },
    async () => { flip("c3"); await wait(flipDur); },
    async () => { flip("c4"); await wait(flipDur); },
    async () => { await moveSceneToSlotLift("s4", "slot-a"); },
    async () => { flip("c5"); await wait(flipDur); },
    async () => { flip("c6"); await wait(flipDur); },
    async () => { flip("c7"); await wait(flipDur); },
    async () => { await moveSceneToSlotLift("s7", "slot-b"); },
    async () => { flip("c8"); await wait(flipDur); }
  ];

  let stepIndex = 0;
  let busy = false;

  async function advance(){
    if(busy) return;
    if(stepIndex >= steps.length){
      document.getElementById("hint").textContent = "Done. Refresh for a new random set.";
      return;
    }
    busy = true;
    try{
      await steps[stepIndex]();
      stepIndex++;
      if(stepIndex >= steps.length){
        document.getElementById("hint").textContent = "Done. Refresh for a new random set.";
      } else {
        document.getElementById("hint").textContent = `Click to step (${stepIndex + 1}/${steps.length})`;
      }
    } finally {
      busy = false;
    }
  }

  // ====== 4) Init ======
  setFacesRandomUnique();
  resetAllCards();

  // Click anywhere to advance (great for AhaSlides)
  document.addEventListener("click", advance);

  // Optional: Space/Enter also advances
  document.addEventListener("keydown", (e) => {
    if(e.code === "Space" || e.code === "Enter"){
      e.preventDefault();
      advance();
    }
  });
</script>

</body>
</html>
